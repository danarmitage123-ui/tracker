<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/danarmitage123-ui/tracker/refs/heads/main/heartbeat.png">
    
    <title>Recovery Pro+</title>
    <style>
        :root { --bg: #0b1f2b; --card: #1a2c38; --primary: #4cc9f0; --accent: #7209b7; --text: #ffffff; --muted: #94a3b8; }
        [data-theme="berry"] { --bg: #1a0b1a; --card: #2c1a2c; --primary: #f72585; --accent: #7209b7; --text: #ffffff; --muted: #b894b8; }
        [data-theme="forest"] { --bg: #0b1a11; --card: #1a2c20; --primary: #4cf08c; --accent: #09b74c; --text: #ffffff; --muted: #94b8a1; }

        html, body { height: 100dvh; overflow-x: hidden; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        body { font-family: -apple-system, system-ui; background: var(--bg); color: var(--text); margin: 0; padding: 15px; box-sizing: border-box; transition: background 0.3s ease; }
        .container { max-width: 100%; margin: 0 auto; padding-bottom: 60px; }
        .header { margin-bottom: 20px; text-align: center; position: relative; }
        h1 { font-size: 22px; margin: 0 0 12px 0; background: linear-gradient(90deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .theme-toggle { position: absolute; right: 0; top: 0; background: var(--card); border: 1px solid #2d3d4d; border-radius: 12px; padding: 8px; font-size: 16px; }
        input[type=date] { background: var(--card); border: 1px solid #2d3d4d; color: white; padding: 10px 15px; border-radius: 25px; font-size: 15px; width: auto; text-align: center; }
        .card { background: var(--card); border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 1px solid #2d3d4d; }
        h3 { font-size: 11px; text-transform: uppercase; color: var(--primary); letter-spacing: 1px; margin: 0 0 15px 0; }
        .snapshot-view { background: linear-gradient(135deg, rgba(76, 201, 240, 0.1) 0%, rgba(114, 9, 183, 0.1) 100%); border: 1px solid var(--primary); }
        .snap-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 12px; }
        .snap-box { background: rgba(0,0,0,0.4); padding: 8px; border-radius: 12px; text-align: center; }
        .snap-box label { font-size: 9px; color: var(--muted); display: block; margin-bottom: 4px; }
        .snap-val { font-size: 11px; font-weight: 700; }
        .time-tabs { display: flex; gap: 6px; background: rgba(0,0,0,0.2); padding: 4px; border-radius: 12px; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; border: none; border-radius: 8px; background: none; color: var(--muted); font-weight: 700; font-size: 13px; }
        .tab.active { background: var(--primary); color: #0b1f2b; }
        .score { font-size: 18px; font-weight: 800; color: var(--primary); }
        input[type=range] { width: 100%; -webkit-appearance: none; background: #2d3d4d; height: 6px; border-radius: 10px; margin-bottom: 15px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; background: #fff; border-radius: 50%; border: 3px solid var(--primary); }
        .food-item input { background: var(--bg); border: 1px solid #2d3d4d; padding: 12px; border-radius: 10px; color: white; font-size: 16px; width: 100%; box-sizing: border-box; margin-bottom: 8px; }
        .btn-save { width: 100%; padding: 18px; border-radius: 18px; border: none; background: linear-gradient(45deg, var(--accent), var(--primary)); color: white; font-weight: 800; font-size: 17px; margin-top: 10px; }
        .mag-row { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .trends-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .trend-card { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; text-align: center; }
        .trend-val { font-size: 20px; font-weight: 800; color: var(--primary); display: block; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <button class="theme-toggle" onclick="toggleTheme()">üé®</button>
        <h1>Recovery Pro+</h1>
        <div class="date-container"><input type="date" id="datePicker" onchange="loadData()"></div>
    </div>

    <div class="card snapshot-view">
        <h3>Today's Snapshot</h3>
        <div class="snap-grid">
            <div class="snap-box"><label>AM</label><div class="snap-val" id="sAM">‚ö° -- | ‚òÅÔ∏è --</div></div>
            <div class="snap-box"><label>PM</label><div class="snap-val" id="sPM">‚ö° -- | ‚òÅÔ∏è --</div></div>
            <div class="snap-box"><label>NIGHT</label><div class="snap-val" id="sNT">‚ö° -- | ‚òÅÔ∏è --</div></div>
        </div>
        <div id="sDetails" style="font-size:12px; border-top:1px solid rgba(255,255,255,0.1); padding-top:8px;">
            <span id="sMag">üíä Mag: --</span> | <span id="sWater">üíß Water: 0</span>
        </div>
        <div id="sMeals" style="font-size:12px; margin-top:5px; color:var(--muted);">No meals logged.</div>
    </div>

    <div class="card">
        <h3>Log Entry</h3>
        <div class="time-tabs">
            <button class="tab active" onclick="setT(this,'AM')">AM</button>
            <button class="tab" onclick="setT(this,'PM')">PM</button>
            <button class="tab" onclick="setT(this,'Night')">Night</button>
        </div>
        <div class="label-row"><span>Energy ‚ö°</span> <span class="score" id="ev">5</span></div>
        <input type="range" id="e" min="1" max="10" value="5" oninput="ev.innerText=this.value">
        <div class="label-row"><span>Brain Fog ‚òÅÔ∏è</span> <span class="score" id="fv">5</span></div>
        <input type="range" id="f" min="1" max="10" value="5" oninput="fv.innerText=this.value">
        
        <div class="food-item"><input type="text" id="fb" placeholder="Breakfast"></div>
        <div class="food-item"><input type="text" id="fl" placeholder="Lunch"></div>
        <div class="food-item"><input type="text" id="fd" placeholder="Dinner"></div>
        <div class="food-item"><input type="text" id="fs" placeholder="Snacks"></div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
            <div class="mag-row"><input type="checkbox" id="magIn" style="width:20px; height:20px;"> <label>Magnesium</label></div>
            <div style="display:flex; align-items:center;">
                <button onclick="addW(-1)" style="width:30px; height:30px; border-radius:8px; border:none; background:var(--primary); font-weight:bold;">-</button>
                <b id="wv" style="margin:0 10px;">0</b>
                <button onclick="addW(1)" style="width:30px; height:30px; border-radius:8px; border:none; background:var(--primary); font-weight:bold;">+</button>
            </div>
        </div>
        <button class="btn-save" onclick="save()">Update Dashboard</button>
    </div>

    <div class="card">
        <h3>Weekly Trends (Last 7 Days)</h3>
        <div class="trends-grid">
            <div class="trend-card"><span class="trend-val" id="avgE">-</span>Avg Energy</div>
            <div class="trend-card"><span class="trend-val" id="avgF">-</span>Avg Fog</div>
        </div>
    </div>
</div>

<script>
    let activeTime = 'AM';
    let db = JSON.parse(localStorage.getItem('recovery_final_db') || '{}');
    const dt = document.getElementById('datePicker');
    dt.valueAsDate = new Date();

    function toggleTheme() {
        const themes = ['default', 'berry', 'forest'];
        let current = document.body.getAttribute('data-theme') || 'default';
        let next = themes[(themes.indexOf(current) + 1) % themes.length];
        document.body.setAttribute('data-theme', next);
        localStorage.setItem('user_theme', next);
    }
    if(localStorage.getItem('user_theme')) document.body.setAttribute('data-theme', localStorage.getItem('user_theme'));

    function setT(btn, t) {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeTime = t;
    }

    function addW(val) {
        let wv = document.getElementById('wv');
        wv.innerText = Math.max(0, parseInt(wv.innerText) + val);
    }

    function save() {
        const d = dt.value;
        if(!db[d]) db[d] = { am:{}, pm:{}, night:{}, food:{}, water:0, mag:false };
        db[d][activeTime.toLowerCase()] = { e: document.getElementById('e').value, f: document.getElementById('f').value };
        db[d].food = { b: document.getElementById('fb').value, l: document.getElementById('fl').value, d: document.getElementById('fd').value, s: document.getElementById('fs').value };
        db[d].water = parseInt(document.getElementById('wv').innerText);
        db[d].mag = document.getElementById('magIn').checked;
        localStorage.setItem('recovery_final_db', JSON.stringify(db));
        loadData();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function loadData() {
        const d = dt.value;
        const data = db[d] || { am:{}, pm:{}, night:{}, food:{}, water:0, mag:false };
        const fmt = (slot) => slot.e ? `‚ö°<b>${slot.e}</b> | ‚òÅÔ∏è<b>${slot.f}</b>` : `‚ö°-- | ‚òÅÔ∏è--`;
        
        document.getElementById('sAM').innerHTML = fmt(data.am);
        document.getElementById('sPM').innerHTML = fmt(data.pm);
        document.getElementById('sNT').innerHTML = fmt(data.night);
        document.getElementById('sWater').innerText = `üíß Water: ${data.water || 0}`;
        document.getElementById('sMag').innerText = `üíä Mag: ${data.mag ? '‚úÖ' : '‚ùå'}`;
        
        const f = data.food;
        document.getElementById('sMeals').innerHTML = f.b ? `<b>B:</b> ${f.b||'-'} | <b>L:</b> ${f.l||'-'}<br><b>D:</b> ${f.d||'-'}` : "No meals logged.";
        
        // Trends calculation
        const history = Object.values(db).slice(-7);
        if(history.length > 0) {
            let totalE = 0, totalF = 0, count = 0;
            history.forEach(day => {
                ['am','pm','night'].forEach(s => {
                    if(day[s] && day[s].e) { totalE += parseInt(day[s].e); totalF += parseInt(day[s].f); count++; }
                });
            });
            if(count > 0) {
                document.getElementById('avgE').innerText = (totalE/count).toFixed(1);
                document.getElementById('avgF').innerText = (totalF/count).toFixed(1);
            }
        }
        
        document.getElementById('magIn').checked = data.mag;
        document.getElementById('fb').value = f.b || ''; document.getElementById('fl').value = f.l || '';
        document.getElementById('fd').value = f.d || ''; document.getElementById('fs').value = f.s || '';
        document.getElementById('wv').innerText = data.water || 0;
    }
    loadData();
</script>
</body>
</html>
